<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ø®Ø¨Ø§Ø± ØµØ­Ù† ÙˆÙ„ÛŒØ¹ØµØ±</title>

<link rel="icon" type="image/png" href="logo.png">
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Vazirmatn;background:#000;color:#e5e7eb}
.header{background:#111;padding:15px;border-bottom:3px solid #ef4444;position:sticky;top:0;z-index:100}
.title-wrapper{display:flex;gap:15px;justify-content:center}
.title-word-1{color:#239f40;font-size:2.2rem;font-weight:900}
.title-word-2{color:#fff;font-size:2.2rem;font-weight:900}
.title-word-3{color:#da0000;font-size:2.2rem;font-weight:900}
.container{display:flex;gap:20px;max-width:1400px;margin:auto;padding:20px}
.nav-menu{width:200px;display:flex;flex-direction:column}
.nav-item{padding:12px;background:#111;border:2px solid #222;margin-bottom:10px;cursor:pointer;text-align:center}
.nav-item.active,.nav-item:hover{border-color:#ef4444}
.pinned-section{width:330px}
.pinned-news,.article{background:#111;border:2px solid #222;margin-bottom:15px;cursor:pointer}
.pinned-news:hover,.article:hover{border-color:#ef4444}
.pinned-news img,.pinned-news video,
.article img,.article video{width:100%;background:#000;object-fit:contain}
.content{padding:15px}
.article.hidden{display:none}
.modal{display:none;position:fixed;inset:0;background:#000;z-index:1000}
.modal.active{display:block}
.modal-content{max-width:900px;margin:auto;padding:60px 20px}
.modal-close{position:fixed;top:20px;left:20px;width:45px;height:45px;background:#ef4444;border:none;font-size:1.5rem;cursor:pointer}
.full-text{white-space:pre-wrap;line-height:2}
@media(max-width:768px){
.container{flex-direction:column}
.nav-menu{flex-direction:row;width:100%;justify-content:center}
}
</style>
</head>

<body>

<div class="header">
  <div class="title-wrapper">
    <h1 class="title-word-1">Ø§Ø®Ø¨Ø§Ø±</h1>
    <h1 class="title-word-2">ØµØ­Ù†</h1>
    <h1 class="title-word-3">ÙˆÙ„ÛŒØ¹ØµØ±</h1>
  </div>
</div>

<div class="container">

<nav class="nav-menu">
  <div class="nav-item active" id="homeBtn">Ù‡Ù…Ù‡</div>
  <div class="nav-item" id="videoBtn">ÙˆÛŒØ¯ÛŒÙˆ</div>
  <div class="nav-item" id="imageBtn">ØªØµÙˆÛŒØ±</div>
</nav>

<aside class="pinned-section">
  <h3>ðŸ“Œ Ø§Ø®Ø¨Ø§Ø± ÙˆÛŒÚ˜Ù‡</h3>
  <div id="pinnedNews">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
</aside>

<main style="flex:1">
  <div id="news">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
</main>

</div>

<div id="modal" class="modal">
  <button class="modal-close" onclick="closeModal()">Ã—</button>
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
const newsEl = document.getElementById('news');
const pinnedEl = document.getElementById('pinnedNews');
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');

const textCache = new Map();
let allArticles = [];

async function fetchText(url){
  if(textCache.has(url)) return textCache.get(url);
  const r = await fetch(url,{cache:'force-cache'});
  const t = await r.text();
  textCache.set(url,t);
  return t;
}

function createMedia(folder){
  const video = document.createElement('video');
  video.src = `articles/${folder}/cover.mp4`;
  video.controls = true;
  video.preload = 'metadata';
  video.loading = 'lazy';

  video.onerror = ()=>{
    const img = document.createElement('img');
    img.src = `articles/${folder}/cover.jpg`;
    img.loading = 'lazy';
    video.replaceWith(img);
  };
  return video;
}

async function loadArticle(folder, target){
  try{
    const txt = await fetchText(`articles/${folder}/text.txt`);
    const [title,...rest] = txt.split('\n');
    const body = rest.join('\n');

    const box = document.createElement('div');
    box.className = target === 'pinned' ? 'pinned-news' : 'article';
    box.onclick = ()=>openModal(folder,title,body);

    const content = document.createElement('div');
    content.className = 'content';
    content.innerHTML = `<h3>${title}</h3><p>${body.slice(0,120)}...</p>`;

    const media = createMedia(folder);

    box.append(content);
    box.prepend(media);

    if(target === 'main'){
      allArticles.push({el:box, type:media.tagName === 'VIDEO' ? 'video':'img'});
    }
    return box;
  }catch{ return null; }
}

async function loadNews(){
  const data = await fetch('articles/index.json').then(r=>r.json());

  pinnedEl.innerHTML='';
  newsEl.innerHTML='';
  allArticles=[];

  for(const f of data.pinned){
    const a = await loadArticle(f,'pinned');
    if(a) pinnedEl.appendChild(a);
  }

  for(let i=0;i<data.articles.length;i++){
    const a = await loadArticle(data.articles[i],'main');
    if(a) newsEl.appendChild(a);
    if(i%3===0) await new Promise(r=>setTimeout(r,0));
  }
}

function filter(type){
  allArticles.forEach(a=>{
    a.el.classList.toggle('hidden', type!=='all' && a.type!==type);
  });
}

function openModal(folder,title,body){
  modalContent.innerHTML = `
    <video src="articles/${folder}/cover.mp4" controls onerror="this.replaceWith(Object.assign(document.createElement('img'),{src:'articles/${folder}/cover.jpg'}))"></video>
    <h1>${title}</h1>
    <div class="full-text">${body}</div>`;
  modal.classList.add('active');
}

function closeModal(){ modal.classList.remove('active'); }

homeBtn.onclick=()=>filter('all');
videoBtn.onclick=()=>filter('video');
imageBtn.onclick=()=>filter('img');

loadNews();
</script>

</body>
</html>
