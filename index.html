<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>اخبار صحن ولیعصر</title>

<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
*{box-sizing:border-box}
body{margin:0;background:#000;color:#e5e7eb;font-family:Vazirmatn}

/* ===== HEADER ===== */
.header{
  position:sticky;top:0;z-index:100;
  height:90px;
  background:#000;
  border-bottom:3px solid #ef4444;
  overflow:hidden;
}
.header::before{
  content:"";
  position:absolute;inset:-40%;
  background:
    linear-gradient(90deg,
      rgba(0,122,61,.25) 0%,
      rgba(255,255,255,.25) 50%,
      rgba(218,0,0,.25) 100%);
  transform:rotate(-12deg) scale(1.3);
}
.header-content{
  position:relative;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
}
.title-wrapper{display:flex;gap:12px}
.title-word-1{color:#239f40;font-size:2rem;font-weight:900}
.title-word-2{color:#fff;font-size:2rem;font-weight:900}
.title-word-3{color:#da0000;font-size:2rem;font-weight:900}

/* ===== LAYOUT ===== */
.container{max-width:1400px;margin:auto;padding:20px;display:flex;gap:20px}

/* NAV */
.nav-menu{width:200px;display:flex;flex-direction:column;gap:10px}
.nav-item{
  background:#111;border:2px solid #222;padding:14px;
  text-align:center;cursor:pointer
}
.nav-item.active,.nav-item:hover{border-color:#ef4444}

/* PINNED */
.pinned-section{width:340px}
.pinned-title{
  text-align:center;
  color:#ef4444;
  border:2px solid #ef4444;
  padding:12px;
  margin-bottom:10px
}
.pinned-wrapper{display:flex;flex-direction:column;gap:12px}
.pinned-news{border:2px solid #333;background:#111;cursor:pointer}
.pinned-news img,.pinned-news video{width:100%;background:#000}
.pinned-news .content{padding:10px}

/* MAIN */
.main-news{flex:1;display:flex;flex-direction:column;gap:20px}
.article{background:#111;border:2px solid #222;cursor:pointer}
.article.hidden{display:none}
.article img,.article video{width:100%;background:#000}
.article .content{padding:15px}

/* SIDEBAR */
.sidebar{width:250px}
.search-box,.eitaa-box{background:#111;border:2px solid #222;padding:15px;margin-bottom:15px}
.eitaa-link{
  display:block;
  background:#ef4444;
  color:#000;
  padding:12px;
  text-decoration:none;
  font-weight:bold
}

/* MODAL */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:999}
.modal.active{display:block}
.modal-content{max-width:900px;margin:auto;padding:40px}
.modal-close{position:fixed;top:20px;left:20px;background:#ef4444;border:none;width:45px;height:45px}

/* ===== MOBILE ===== */
@media(max-width:768px){
  .container{flex-direction:column}
  .nav-menu{flex-direction:row;width:100%;justify-content:center}
  .sidebar{display:block}
  
  /* PINNED MOBILE FIX */
  .pinned-wrapper{
    flex-direction:row;
    overflow-x:auto;
    overflow-y:hidden;
    gap:10px;
  }
  .pinned-news{
    min-width:260px;
    flex:0 0 auto;
  }
}
</style>
</head>

<body>

<div class="header">
  <div class="header-content">
    <div class="title-wrapper">
      <div class="title-word-1">اخبار</div>
      <div class="title-word-2">صحن</div>
      <div class="title-word-3">ولیعصر</div>
    </div>
  </div>
</div>

<div class="container">

<nav class="nav-menu">
  <div class="nav-item active" onclick="setFilter('all')">صفحه اصلی</div>
  <div class="nav-item" onclick="setFilter('video')">ویدیوها</div>
  <div class="nav-item" onclick="setFilter('image')">تصاویر</div>
</nav>

<aside class="pinned-section">
  <div class="pinned-title">اخبار ویژه</div>
  <div id="pinnedNews" class="pinned-wrapper"></div>
</aside>

<main class="main-news" id="news"></main>

<aside class="sidebar">
  <div class="search-box">
    <input id="searchInput" placeholder="جستجو..." style="width:100%">
  </div>
  <div class="eitaa-box">
    <a class="eitaa-link" href="https://eitaa.com/valiasrfoari" target="_blank">
      عضویت در کانال ایتا
    </a>
  </div>
</aside>

</div>

<div class="modal" id="modal">
  <button class="modal-close" onclick="closeModal()">×</button>
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
let allArticles=[],currentFilter='all';

fetch('articles/index.json?'+Date.now())
.then(r=>r.json())
.then(d=>{
  d.pinned.forEach(f=>loadItem(f,true));
  d.articles.forEach(f=>loadItem(f,false));
});

function loadItem(folder,pinned){
 fetch(`articles/${folder}/text.txt`)
 .then(r=>r.text())
 .then(t=>{
   let [title,...c]=t.split('\n');
   let box=document.createElement('div');
   box.className=pinned?'pinned-news':'article';
   box.onclick=()=>openModal(folder,title,c.join('\n'));
   fetch(`articles/${folder}/cover.mp4`)
   .then(r=>{
     let m=r.ok?'video':'img';
     let el=document.createElement(m);
     el.src=`articles/${folder}/cover.${m=='video'?'mp4':'jpg'}`;
     if(m=='video')el.controls=true;
     box.appendChild(el);
     let d=document.createElement('div');
     d.className='content';
     d.innerHTML=`<h3>${title}</h3>`;
     box.appendChild(d);
     (pinned?pinnedNews:news).appendChild(box);
     allArticles.push({el:box,type:m});
   });
 });
}

function setFilter(t){
 currentFilter=t;
 allArticles.forEach(a=>{
   a.el.style.display=
     t=='all'||(t=='video'&&a.type=='video')||(t=='image'&&a.type=='img')
     ?'block':'none';
 });
}

function openModal(f,t,c){
 modal.classList.add('active');
 modalContent.innerHTML=`<h2>${t}</h2><pre>${c}</pre>`;
}
function closeModal(){modal.classList.remove('active')}
</script>

</body>
</html>
